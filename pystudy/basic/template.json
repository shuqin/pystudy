[
  {
    "update": "service_notification_event",
    "updates": [
      {
        "q": {
          "id": "DETECTION_WMI"
        },
        "u": {
          "$set": {
            "name": "可疑WMI事件订阅",
            "type": "NOTICE_TYPE_INTRUSION",
            "subtype": "DETECTION_WMI",
            "display_name": {
              "zh-cn": "可疑WMI事件订阅"
            }
          },
          "$currentDate": {
            "created_at": true,
            "updated_at": true
          }
        },
        "upsert": true
      }
    ]
  },
  {
    "update": "service_notification_template",
    "updates": [
      {
        "q": {
          "id": "DETECTION_WMI_WEB"
        },
        "u": {
          "$set": {
            "name": "WMI-站内信",
            "event_id": "DETECTION_WMI",
            "send_method": "WEB",
            "default_text": {
              "subject": "{% for agentEvent in aggregateAgentEvents %} {% if agentEvent.params.containerId %} [{{ agentEvent.params.detectionSeverity }}]容器{{ agentEvent.params.containerName }}于{{ agentEvent.params.detectionTime }}检测到{{ agentEvent.params.detectionType }}告警:{{ agentEvent.params.content }} {% else %}  [{{ agentEvent.params.detectionSeverity }}]主机{{ agentEvent.params.hostname }}({{ agentEvent.params.displayIp }})于{{ agentEvent.params.detectionTime }}检测到{{ agentEvent.params.detectionType }}告警:{{ agentEvent.params.content }} {% endif %}  {{showOneRecord(aggregateAgentEvent)}} {% endfor %}",
              "body": "<html><!--高危告警链接地址-->{% macro detetionDetailLink(agentEvent) %}<a href=\"{{ agentEvent.domainName }}/{{ agentEvent.detectionUrl }}?{{ agentEvent.params.detectionSearch }}\"   style=\"cursor:pointer; color:#19a5b4; text-decoration: none;\" target='_blank'>查看告警详情</a>{% endmacro %}<!--规则检测详细信息-->{% macro showRulCheckDetail(agentEvent) %}<tr>    <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">        基本信息    </td></tr><tr>    <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">        <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"               width=\"100%\">            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">告警时间：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.detectionTime }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">技术与战术：</span>                    <span style=\"color: #424242;\">                        {% for info in agentEvent.params.attckInfo %}                        \t{{ info.technique }}                        \t{% for tactic in info.tactics %}\t\t\t\t\t{% if forloop.Last %}\t\t\t\t\t\t[{{ tactic }}]\t\t\t\t\t{% else %}\t\t\t\t\t\t[{{ tactic }}],\t\t\t\t\t{% endif %}                        \t{% endfor %}                        {% endfor %}                    </span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">检测方式：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.detectionMethod }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">检测说明：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.actionDesc }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">Consumer类型：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerType }}</span>                </td>            </tr>            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>        </table>    </td></tr>{% if agentEvent.params.wmiInfo %}<tr>    <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">        Consumer信息    </td></tr><tr>    <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">        <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"               width=\"100%\">            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">类型：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerType|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">名称：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerName|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">所在命名空间：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerNamespace|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">执行内容：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerCommand|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>        </table>    </td></tr><tr>    <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">        Filter信息    </td></tr><tr>    <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">        <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"               width=\"100%\">            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">名称：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.filterName|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">所在命名空间：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.filterNamespace|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">过滤语句：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.filterCommand|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>        </table>    </td></tr>{% endif %}{% endmacro %}<!--单条模板-->{% macro showOneRecord(agentEvent) %}<table cellspacing=\"0\" style=\"width: 100%; padding: 0;\">    <tr>        <td>            {{ detetionDetailLink(agentEvent) }}        </td>    </tr>    <tr>        <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">            影响设备        </td>    </tr>    {% if agentEvent.param.containerId %}    <tr>        <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">            <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"                   width=\"100%\">                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">容器名：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.containerName|default:\"--\"}}</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">镜像名：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.imageName|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">集群/命名空间：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.clusterName|default:\"--\" }}/{{ agentEvent.params.namespace|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">节点名：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.displayIp|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>            </table>        </td>    </tr>    {% else %}    <tr>        <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">            <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"                   width=\"100%\">                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">主机名：</span><span                            style=\"color: #424242;\">{{ agentEvent.params.hostname|default:\"--\" }}({{ agentEvent.params.displayIp }})</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">操作系统：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.osType|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">业务组：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.groupName|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>            </table>        </td>    </tr>    {% endif %}    <!--详细信息-->    {{ showRulCheckDetail(agentEvent) }}    <tr>        <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: 'Microsoft YaHei',SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">            处理建议        </td>    </tr>    <tr>        <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">            <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"                   width=\"100%\">                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;word-break: break-all;\">                        <span style=\"color: #6d6d6d;\">{{ agentEvent.params.handleSuggestion }}</span>                    </td>                </tr>                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>            </table>        </td>    </tr></table>{% endmacro %}<body><!--展示逻辑开始-->{% for aggregateAgentEvent in aggregateAgentEvents %}{{ showOneRecord(aggregateAgentEvent) }}{% endfor %}</body></html>",
              "language": "zh-CN"
            }
          },
          "$currentDate": {
            "created_at": true,
            "updated_at": true
          }
        },
        "upsert": true
      }
    ]
  },
  {
    "update": "service_notification_template",
    "updates": [
      {
        "q": {
          "id": "DETECTION_WMI_EMAIL"
        },
        "u": {
          "$set": {
            "name": "可疑WMI事件订阅-邮件",
            "event_id": "DETECTION_WMI",
            "send_method": "EMAIL",
            "default_text": {
              "subject": "{% for agentEvent in aggregateAgentEvents %} {% if agentEvent.params.containerId %} [{{ agentEvent.params.detectionSeverity }}]容器{{ agentEvent.params.containerName }}于{{ agentEvent.params.detectionTime }}检测到{{ agentEvent.params.detectionType }}告警:{{ agentEvent.params.content }} {% else %}  [{{ agentEvent.params.detectionSeverity }}]主机{{ agentEvent.params.hostname }}({{ agentEvent.params.displayIp }})于{{ agentEvent.params.detectionTime }}检测到{{ agentEvent.params.detectionType }}告警:{{ agentEvent.params.content }} {% endif %}  {{showOneRecord(aggregateAgentEvent)}} {% endfor %}",
              "body": "<html><!--高危告警链接地址-->{% macro detetionDetailLink(agentEvent) %}<a href=\"{{ agentEvent.domainName }}/{{ agentEvent.detectionUrl }}?{{ agentEvent.params.detectionSearch }}\"   style=\"cursor:pointer; color:#19a5b4; text-decoration: none;\" target='_blank'>查看告警详情</a>{% endmacro %}<!--规则检测详细信息-->{% macro showRulCheckDetail(agentEvent) %}<tr>    <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">        基本信息    </td></tr><tr>    <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">        <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"               width=\"100%\">            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">告警时间：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.detectionTime }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">技术与战术：</span>                    <span style=\"color: #424242;\">                        {% for info in agentEvent.params.attckInfo %}                        \t{{ info.technique }}                        \t{% for tactic in info.tactics %}\t\t\t\t\t{% if forloop.Last %}\t\t\t\t\t\t[{{ tactic }}]\t\t\t\t\t{% else %}\t\t\t\t\t\t[{{ tactic }}],\t\t\t\t\t{% endif %}                        \t{% endfor %}                        {% endfor %}                    </span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">检测方式：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.detectionMethod }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">检测说明：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.actionDesc }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">Consumer类型：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerType }}</span>                </td>            </tr>            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>        </table>    </td></tr>{% if agentEvent.params.wmiInfo %}<tr>    <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">        Consumer信息    </td></tr><tr>    <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">        <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"               width=\"100%\">            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">类型：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerType|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">名称：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerName|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">所在命名空间：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerNamespace|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">执行内容：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.consumerCommand|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>        </table>    </td></tr><tr>    <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">        Filter信息    </td></tr><tr>    <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">        <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"               width=\"100%\">            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">名称：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.filterName|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">所在命名空间：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.filterNamespace|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                    <span style=\"color: #6d6d6d;\">过滤语句：</span>                    <span style=\"color: #424242;\">{{ agentEvent.params.wmiInfo.filterCommand|default:\"--\" }}</span>                </td>            </tr>            <tr>                <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>            </tr>        </table>    </td></tr>{% endif %}{% endmacro %}<!--单条模板-->{% macro showOneRecord(agentEvent) %}<table cellspacing=\"0\" style=\"width: 100%; padding: 0;\">    <tr>        <td>            {{ detetionDetailLink(agentEvent) }}        </td>    </tr>    <tr>        <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">            影响设备        </td>    </tr>    {% if agentEvent.param.containerId %}    <tr>        <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">            <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"                   width=\"100%\">                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">容器名：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.containerName|default:\"--\"}}</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">镜像名：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.imageName|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">集群/命名空间：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.clusterName|default:\"--\" }}/{{ agentEvent.params.namespace|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">节点名：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.displayIp|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>            </table>        </td>    </tr>    {% else %}    <tr>        <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">            <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"                   width=\"100%\">                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">主机名：</span><span                            style=\"color: #424242;\">{{ agentEvent.params.hostname|default:\"--\" }}({{ agentEvent.params.displayIp }})</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">操作系统：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.osType|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;\">                        <span style=\"color: #6d6d6d;\">业务组：</span>                        <span style=\"color: #424242;\">{{ agentEvent.params.groupName|default:\"--\" }}</span>                    </td>                </tr>                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>            </table>        </td>    </tr>    {% endif %}    <!--详细信息-->    {{ showRulCheckDetail(agentEvent) }}    <tr>        <td style=\"padding: 14px 0 2px 0; line-height: 25px; color: #424242; word-break: break-all; font-family: 'Microsoft YaHei',SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif; font-size: 13px;\">            处理建议        </td>    </tr>    <tr>        <td style=\"padding: 0 16px; background: #fdfdfd; border: 1px solid #ececec;\">            <table cellspacing=\"0\" style=\"border-collapse: collapse; word-break: break-all; width:100%;\"                   width=\"100%\">                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>                <tr>                    <td style=\"padding: 0; font-size: 13px;line-height: 28px;font-family: Microsoft YaHei,SimSun,Tahoma,Verdana,Arial,Helvetica,sans-serif;word-break: break-all;\">                        <span style=\"color: #6d6d6d;\">{{ agentEvent.params.handleSuggestion }}</span>                    </td>                </tr>                <tr>                    <td height=\"5\" style=\"height: 5px; padding: 0;\"></td>                </tr>            </table>        </td>    </tr></table>{% endmacro %}<body><!--展示逻辑开始-->{% for aggregateAgentEvent in aggregateAgentEvents %}{{ showOneRecord(aggregateAgentEvent) }}{% endfor %}</body></html>",
              "language": "zh-CN"
            }
          },
          "$currentDate": {
            "created_at": true,
            "updated_at": true
          }
        },
        "upsert": true
      }
    ]
  },
  {
    "update": "service_notification_template",
    "updates": [
      {
        "q": {
          "id": "DETECTION_WMI_SMS"
        },
        "u": {
          "$set": {
            "name": "可疑WMI事件订阅-短信",
            "event_id": "DETECTION_WMI",
            "send_method": "SMS",
            "default_text": {
              "subject": "入侵告警通知，建议立即处理",
              "body": "{% for agentEvent in aggregateAgentEvents %} {% if agentEvent.params.containerId %}  [{{ agentEvent.params.detectionSeverity }}]容器{{ agentEvent.params.containerName }}于{{ agentEvent.params.detectionTime }}检测到{{ agentEvent.params.detectionType }}告警:{{ agentEvent.params.content }} {% else %}     [{{ agentEvent.params.detectionSeverity }}]主机{{ agentEvent.params.hostname }}({{ agentEvent.params.displayIp }})于{{ agentEvent.params.detectionTime }}检测到{{ agentEvent.params.detectionType }}告警:{{ agentEvent.params.content }} {% endif %}  {{showOneRecord(aggregateAgentEvent)}} {% endfor %}",
              "language": "zh-CN"
            }
          },
          "$currentDate": {
            "created_at": true,
            "updated_at": true
          }
        },
        "upsert": true
      }
    ]
  }
]
